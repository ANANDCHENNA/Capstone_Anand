<div class="container my-4">

  <!-- Search + Sort Controls -->
  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <input type="text" class="form-control" placeholder="Search..." [(ngModel)]="searchText" />
    </div>
    <div class="col-md-4">
      <select class="form-select" [(ngModel)]="sortKey">
        <option value="">Sort By</option>
        <option value="id">ID</option>
        <option value="status">Status</option>
      </select>
    </div>
    <div class="col-md-4">
      <select class="form-select" [(ngModel)]="sortOrder">
        <option value="asc">Ascending</option>
        <option value="desc">Descending</option>
      </select>
    </div>
  </div>

  <!-- ADJUSTER -->
  <!-- <div *ngIf="role === 'ADJUSTER'" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div class="col" *ngFor="let claim of filteredAdjusterClaims()">
      <div class="card gradient-card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Claim #{{ claim.id }}</h5>
          <p class="card-text text-truncate">{{ claim.description }}</p>
          <p><strong>Date:</strong> {{ claim.date | date:'dd-MM-yyyy' }}</p>
          <span class="badge" [ngClass]="getStatusClass(claim.status)">{{ claim.status }}</span>
        </div>
        <div class="card-footer d-flex justify-content-between">
          <button class="btn btn-outline-light btn-sm" (click)="onAdjusterAssignClaim(claim.id)">
            {{ claim.underwriter ? 'Assigned' : 'Assign' }}
          </button>
          <button class="btn btn-light btn-sm" (click)="openClaimModal(claim)">Details</button>
        </div>
      </div>
    </div>
  </div> -->


  <div *ngIf="role === 'ADJUSTER'" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div class="col" *ngFor="let claim of filteredAdjusterClaims()">
      <div class="card gradient-card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">
            <i class="fas fa-file-alt me-2 text-primary"></i> Claim #{{ claim.id }}
          </h5>
          <p class="card-text text-truncate">
            <i class="fas fa-align-left me-2 text-secondary"></i> {{ claim.description }}
          </p>
          <p>
            <i class="fas fa-calendar-alt me-2 text-info"></i>
            <strong>Date:</strong> {{ claim.date | date:'dd-MM-yyyy' }}
          </p>
          <p>
            <i class="fas fa-flag me-2 text-warning"></i>
            <strong>Status:</strong>
            <span class="badge" [ngClass]="getStatusClass(claim.status)">
              {{ claim.status }}
            </span>
          </p>
        </div>
        <div class="card-footer d-flex justify-content-between">
          <button class="btn btn-outline-light btn-sm" (click)="onAdjusterAssignClaim(claim.id)">
            {{ claim.underwriter ? 'Assigned' : 'Assign' }}
          </button>
          <button class="btn btn-light btn-sm" (click)="openClaimModal(claim)">Details</button>
        </div>
      </div>
    </div>
  </div>

  
    

  <!-- UNDERWRITER -->
  <div *ngIf="role === 'UNDERWRITER'" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div class="col" *ngFor="let claim of filteredUnderwriterClaims()">
      <div class="card gradient-card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Claim #{{ claim.id }}</h5>
          <p class="card-text text-truncate">{{ claim.description }}</p>
          <p><strong>Date:</strong> {{ claim.date | date:'dd-MM-yyyy' }}</p>
          <span class="badge" [ngClass]="getStatusClass(claim.status)">{{ claim.status }}</span>
        </div>
        <div class="card-footer text-center">
          <button class="btn btn-light btn-sm w-100" (click)="onUnderwriterUpdateClaim(claim.id)">
            Update
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- INVESTIGATOR -->
  <div *ngIf="role === 'INVESTIGATOR'" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div class="col" *ngFor="let investigation of filteredInvestigatorRecords()">
      <div class="card gradient-card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Investigation #{{ investigation.id }}</h5>
          <p class="card-text text-truncate">Investigation ID:{{ investigation.id }}</p>
          <p><strong>Claim:</strong> {{ investigation.claim.description }}</p>
          <span class="badge" [ngClass]="getStatusClass(investigation.status)">{{ investigation.status }}</span>
        </div>
        <div class="card-footer text-center">
          <button class="btn btn-light btn-sm w-100" (click)="onInvestigatorUpdateInvestigation(investigation.id)">
            Update
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- POLICYHOLDER -->
  <div *ngIf="role === 'POLICYHOLDER'" class="container">
    <!-- Connection status and debug info -->
    <div class="row mb-4" *ngIf="hasError">
      <div class="col">
        <div class="alert alert-danger">
          <h5>Connection Error</h5>
          <p>There was an error connecting to the server. Please try the test connection button below.</p>
          <button class="btn btn-primary me-2" (click)="testConnection()" [disabled]="isLoading">
            {{ isLoading ? 'Testing...' : 'Test Connection' }}
          </button>
          <button class="btn btn-secondary" (click)="loadPolicyholderClaims()" [disabled]="isLoading">
            {{ isLoading ? 'Loading...' : 'Retry Loading Claims' }}
          </button>
          <div *ngIf="errorDetails" class="mt-3">
            <pre class="bg-light p-3 rounded">{{ errorDetails }}</pre>
          </div>
        </div>
      </div>
    </div>

    <!-- Claims grid -->
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      <div class="col" *ngFor="let claim of filteredPolicyholderClaims()">
        <div class="card gradient-card h-100 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">{{ claim.description }}</h5>
            <p class="card-text text-truncate">Claim ID:{{ claim.id }}</p>
            <p><strong>Date:</strong> {{ claim.date | date:'dd-MM-yyyy' }}</p>
            <span class="badge" [ngClass]="getStatusClass(claim.status)">{{ claim.status }}</span>
          </div>
          <div class="card-footer text-center">
            <button class="btn btn-light btn-sm w-100" (click)="openClaimModal(claim)">View Details</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading indicator -->
    <div *ngIf="isLoading" class="row mt-4">
      <div class="col text-center">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading your claims...</p>
      </div>
    </div>
  </div>

  <!-- ADMIN -->
  <!-- <div *ngIf="role === 'ADMIN'" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div class="col" *ngFor="let policy of filteredPolicies()">
      <div class="card gradient-card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Policy #{{ policy.policyNumber }}</h5>
          <p class="card-text"><strong>Type:</strong> {{ policy.policyType }}</p>
          <p><strong>Premium:</strong> â‚¹{{ policy.premium }}</p>
          <p><strong>Term:</strong> {{ policy.termMonths }} months</p>
          <span class="badge bg-success">{{ policy.status }}</span>
        </div>
        <div class="card-footer text-center">
          <button class="btn btn-outline-light btn-sm" (click)="editPolicy(policy)">Edit</button>
          <button class="btn btn-danger btn-sm ms-2" (click)="deletePolicy(policy.id)">Delete</button>
        </div>
      </div>
    </div>
  </div> -->

  <!-- Claim Details Modal -->
  <div class="modal fade" id="claimModal" tabindex="-1" aria-labelledby="claimModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header modal-gradient text-white">
          <h5 class="modal-title" id="claimModalLabel">Claim #{{ selectedClaim?.id }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p><strong>Description:</strong> {{ selectedClaim?.description }}</p>
          <p><strong>Date:</strong> {{ selectedClaim?.date | date:'dd-MM-yyyy' }}</p>
          <p><strong>Status:</strong> {{ selectedClaim?.status}}</p>
            <p> <strong>Underwriter:</strong> {{ selectedClaim?.underwriter?.username || 'Not Assigned' }}</p>
            <p> <strong>Investigator:</strong> {{ selectedClaim?.investigator?.username || 'Not Assigned' }}</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button *ngIf="role==='ADJUSTER'" class="btn btn-primary" (click)="onUpdateClaimAdjuster(selectedClaim.id)">Update</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="snackbarToast" class="toast text-bg-success" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">{{ snackbarMessage }}</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
          aria-label="Close"></button>
      </div>
    </div>
  </div>

</div>
