<div class="container my-4">

  <h3 class=" color: #003366; font-weight:600;text-primary  fw-bold">{{welcomeMessage}}</h3>
  <hr>
  <!-- Search + Sort Controls -->
  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <input type="text" class="form-control" placeholder="Search..." [(ngModel)]="searchText" />
    </div>
    <div class="col-md-4">
      <select class="form-select" [(ngModel)]="sortKey">
        <option value="">Sort By</option>
        <option value="id">ID</option>
        <option value="status">Status</option>
      </select>
    </div>
    <div class="col-md-4">
      <select class="form-select" [(ngModel)]="sortOrder">
        <option value="asc">Ascending</option>
        <option value="desc">Descending</option>
      </select>
    </div>
  </div>

  <!-- ADJUSTER -->
  <div *ngIf="role === 'ADJUSTER'" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div class="col" *ngFor="let claim of getPaginatedClaims('ADJUSTER')">
      <div class="card gradient-card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Claim #{{ claim.id }}</h5>
          <p class="card-text text-truncate">{{ claim.description }}</p>
          <p><strong>Date:</strong> {{ claim.date | date:'dd-MM-yyyy' }}</p>
          <span class="badge" [ngClass]="getStatusClass(claim.status)">{{ claim.status }}</span>
        </div>
        <div class="card-footer d-flex justify-content-between">
          <button class="btn btn-outline-light btn-sm" (click)="onAdjusterAssignClaim(claim.id)">
            {{ claim.underwriter ? 'Assigned' : 'Assign' }}
          </button>
          <button class="btn btn-light btn-sm" (click)="openClaimModal(claim)">Details</button>
        </div>
      </div>
    </div>
  </div>

<!-- --------adjuster change for checking pagingh------------- -->



<!-- Pagination controls -->
<nav *ngIf="getTotalPages('ADJUSTER') > 1" class="mt-3">
  <ul class="pagination justify-content-center">
    <li class="page-item" [class.disabled]="currentPage['ADJUSTER'] === 1">
      <a class="page-link" (click)="changePage('ADJUSTER', currentPage['ADJUSTER'] - 1)">Previous</a>
    </li>
    <li class="page-item" *ngFor="let page of [].constructor(getTotalPages('ADJUSTER')); let i = index"
        [class.active]="currentPage['ADJUSTER'] === i + 1">
      <a class="page-link" (click)="changePage('ADJUSTER', i + 1)">{{ i + 1 }}</a>
    </li>
    <li class="page-item" [class.disabled]="currentPage['ADJUSTER'] === getTotalPages('ADJUSTER')">
      <a class="page-link" (click)="changePage('ADJUSTER', currentPage['ADJUSTER'] + 1)">Next</a>
    </li>
  </ul>
</nav>





  <!-- <div *ngIf="role === 'ADJUSTER'" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div class="col" *ngFor="let claim of filteredAdjusterClaims()">
      <div class="card gradient-card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">
            <i class="fas fa-file-alt me-2 text-primary"></i> Claim #{{ claim.id }}
          </h5>
          <p class="card-text text-truncate">
            <i class="fas fa-align-left me-2 text-secondary"></i> {{ claim.description }}
          </p>
          <p>
            <i class="fas fa-calendar-alt me-2 text-info"></i>
            <strong>Date:</strong> {{ claim.date | date:'dd-MM-yyyy' }}
          </p>
          <p>
            <i class="fas fa-flag me-2 text-warning"></i>
            <strong>Status:</strong>
            <span class="badge" [ngClass]="getStatusClass(claim.status)">
              {{ claim.status }}
            </span>
          </p>
        </div>
        <div class="card-footer d-flex justify-content-between">
          <button class="btn btn-outline-light btn-sm" (click)="onAdjusterAssignClaim(claim.id)">
            {{ claim.underwriter ? 'Assigned' : 'Assign' }}
          </button>
          <button class="btn btn-light btn-sm" (click)="openClaimModal(claim)">Details</button>
        </div>
      </div>
    </div>
  </div> -->

  
    

  <!-- UNDERWRITER -->
  <div *ngIf="role === 'UNDERWRITER'" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div class="col" *ngFor="let claim of getPaginatedClaims('UNDERWRITER')">
      <div class="card gradient-card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Claim #{{ claim.id }}</h5>
          <p class="card-text text-truncate">{{ claim.description }}</p>
          <p><strong>Date:</strong> {{ claim.date | date:'dd-MM-yyyy' }}</p>
          <span class="badge" [ngClass]="getStatusClass(claim.status)">{{ claim.status }}</span>
        </div>
        <div class="card-footer text-center">
          <button class="btn btn-light btn-sm w-100" (click)="onUnderwriterUpdateClaim(claim.id)">
            Update
          </button>
        </div>
      </div>
    </div>
  </div>

 <nav *ngIf="getTotalPages('UNDERWRITER') > 1" class="mt-3">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage['UNDERWRITER'] === 1">
        <a class="page-link" (click)="changePage('UNDERWRITER', currentPage['UNDERWRITER'] - 1)">Previous</a>
      </li>
      <li class="page-item" *ngFor="let page of [].constructor(getTotalPages('UNDERWRITER')); let i = index"
          [class.active]="currentPage['UNDERWRITER'] === i + 1">
        <a class="page-link" (click)="changePage('UNDERWRITER', i + 1)">{{ i + 1 }}</a>
      </li>
      <li class="page-item" [class.disabled]="currentPage['UNDERWRITER'] === getTotalPages('UNDERWRITER')">
        <a class="page-link" (click)="changePage('UNDERWRITER', currentPage['UNDERWRITER'] + 1)">Next</a>
      </li>
    </ul>
  </nav>
  



  <!-- INVESTIGATOR -->
  <div *ngIf="role === 'INVESTIGATOR'" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div class="col" *ngFor="let investigation of getPaginatedClaims('INVESTIGATOR')">
      <div class="card gradient-card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Investigation #{{ investigation.id }}</h5>
          <p class="card-text text-truncate">Investigation ID:{{ investigation.id }}</p>
          <p><strong>Claim:</strong> {{ investigation.claim.description }}</p>
          <span class="badge" [ngClass]="getStatusClass(investigation.status)">{{ investigation.status }}</span>
        </div>
        <div class="card-footer text-center">
          <button class="btn btn-light btn-sm w-100" (click)="onInvestigatorUpdateInvestigation(investigation.id)">
            Update
          </button>
        </div>
      </div>
    </div>
  </div>
  <nav *ngIf="getTotalPages('INVESTIGATOR') > 1" class="mt-3">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage['INVESTIGATOR'] === 1">
        <a class="page-link" (click)="changePage('INVESTIGATOR', currentPage['INVESTIGATOR'] - 1)">Previous</a>
      </li>
      <li class="page-item" *ngFor="let page of [].constructor(getTotalPages('INVESTIGATOR')); let i = index"
          [class.active]="currentPage['INVESTIGATOR'] === i + 1">
        <a class="page-link" (click)="changePage('INVESTIGATOR', i + 1)">{{ i + 1 }}</a>
      </li>
      <li class="page-item" [class.disabled]="currentPage['INVESTIGATOR'] === getTotalPages('INVESTIGATOR')">
        <a class="page-link" (click)="changePage('INVESTIGATOR', currentPage['INVESTIGATOR'] + 1)">Next</a>
      </li>
    </ul>
  </nav>
  
  <!-- POLICYHOLDER -->
  <!-- <div *ngIf="role === 'POLICYHOLDER'" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div class="col" *ngFor="let claim of getPaginatedClaims('POLICYHOLDER')">
      <div class="card gradient-card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">{{ claim.description }}</h5>
          <p class="card-text text-truncate">Claim ID:{{ claim.id }}</p>
          <p><strong>Date:</strong> {{ claim.date | date:'dd-MM-yyyy' }}</p>
          <span class="badge" [ngClass]="getStatusClass(claim.status)">{{ claim.status }}</span>
        </div>
      </div>
    </div> -->

    <!-- Claims grid -->
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      <div class="col" *ngFor="let claim of getPaginatedClaims('POLICYHOLDER')">
        <div class="card gradient-card h-100 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">{{ claim.description }}</h5>
            <p class="card-text text-truncate">Claim ID:{{ claim.id }}</p>
            <p><strong>Date:</strong> {{ claim.date | date:'dd-MM-yyyy' }}</p>
            <span class="badge" [ngClass]="getStatusClass(claim.status)">{{ claim.status }}</span>
          </div>
          <div class="card-footer text-center">
            <button class="btn btn-light btn-sm w-100" (click)="openClaimModal(claim)">View Details</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading indicator -->
    <!-- <div *ngIf="isLoading" class="row mt-4">
      <div class="col text-center">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading your claims...</p>
      </div>
    </div>
  </div> -->
  <nav *ngIf="getTotalPages('POLICYHOLDER') > 1" class="mt-3">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage['POLICYHOLDER'] === 1">
        <a class="page-link" (click)="changePage('POLICYHOLDER', currentPage['POLICYHOLDER'] - 1)">Previous</a>
      </li>
      <li class="page-item" *ngFor="let page of [].constructor(getTotalPages('POLICYHOLDER')); let i = index"
          [class.active]="currentPage['POLICYHOLDER'] === i + 1">
        <a class="page-link" (click)="changePage('POLICYHOLDER', i + 1)">{{ i + 1 }}</a>
      </li>
      <li class="page-item" [class.disabled]="currentPage['POLICYHOLDER'] === getTotalPages('POLICYHOLDER')">
        <a class="page-link" (click)="changePage('POLICYHOLDER', currentPage['POLICYHOLDER'] + 1)">Next</a>
      </li>
    </ul>
  </nav>
  
  <!-- ADMIN -->
  <!-- <div *ngIf="role === 'ADMIN'" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div class="col" *ngFor="let policy of filteredPolicies()">
      <div class="card gradient-card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Policy #{{ policy.policyNumber }}</h5>
          <p class="card-text"><strong>Type:</strong> {{ policy.policyType }}</p>
          <p><strong>Premium:</strong> â‚¹{{ policy.premium }}</p>
          <p><strong>Term:</strong> {{ policy.termMonths }} months</p>
          <span class="badge bg-success">{{ policy.status }}</span>
        </div>
        <div class="card-footer text-center">
          <button class="btn btn-outline-light btn-sm" (click)="editPolicy(policy)">Edit</button>
          <button class="btn btn-danger btn-sm ms-2" (click)="deletePolicy(policy.id)">Delete</button>
        </div>
      </div>
    </div>
  </div> -->

  <!-- Claim Details Modal -->
  <div class="modal fade" id="claimModal" tabindex="-1" aria-labelledby="claimModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header modal-gradient text-white">
          <h5 class="modal-title" id="claimModalLabel">Claim #{{ selectedClaim?.id }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p><strong>Description:</strong> {{ selectedClaim?.description }}</p>
          <p><strong>Date:</strong> {{ selectedClaim?.date | date:'dd-MM-yyyy' }}</p>
          <p><strong>Status:</strong> {{ selectedClaim?.status}}</p>
            <p> <strong>Underwriter:</strong> {{ selectedClaim?.underwriter?.username || 'Not Assigned' }}</p>
            <p> <strong>Investigator:</strong> {{ selectedClaim?.investigator?.username || 'Not Assigned' }}</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button *ngIf="role==='ADJUSTER'" class="btn btn-primary" (click)="onUpdateClaimAdjuster(selectedClaim.id)">Update</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="snackbarToast" class="toast text-bg-success" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">{{ snackbarMessage }}</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
          aria-label="Close"></button>
      </div>
    </div>
  </div>

</div>
