<div class="container my-4">

  <!-- Search + Sort Controls -->
  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="input-group">
        <span class="input-group-text"><i class="fas fa-search"></i></span>
        <input type="text" class="form-control" placeholder="Search..." [(ngModel)]="searchText" />
      </div>
    </div>
    <div class="col-md-4">
      <div class="input-group">
        <span class="input-group-text"><i class="fas fa-sort"></i></span>
        <select class="form-select" [(ngModel)]="sortKey">
          <option value="">Sort By</option>
          <option value="id"><i class="fas fa-hashtag me-2"></i> ID</option>
          <option value="status"><i class="fas fa-info-circle me-2"></i> Status</option>
        </select>
      </div>
    </div>
    <div class="col-md-4">
      <div class="input-group">
        <span class="input-group-text"><i class="fas fa-sort-amount-down"></i></span>
        <select class="form-select" [(ngModel)]="sortOrder">
          <option value="asc">Ascending</option>
          <option value="desc">Descending</option>
        </select>
      </div>
    </div>
  </div>

  <!-- ADJUSTER -->
  <div *ngIf="role === 'ADJUSTER'" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div class="col" *ngFor="let claim of filteredAdjusterClaims()">
      <div class="card gradient-card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">
            <i class="fas fa-file-alt me-2 text-primary"></i> Claim #{{ claim.id }}
          </h5>
          <p class="card-text text-truncate">
            <i class="fas fa-align-left me-2 text-secondary"></i> {{ claim.description }}
          </p>
          <p>
            <i class="fas fa-calendar-alt me-2 text-info"></i>
            <strong>Date:</strong> {{ claim.date | date:'dd-MM-yyyy' }}
          </p>
          <p>
            <i class="fas fa-flag me-2 text-warning"></i>
            <strong>Status:</strong>
            <span class="badge" [ngClass]="getStatusClass(claim.status)">
              {{ claim.status }}
            </span>
          </p>
        </div>
        <div class="card-footer d-flex justify-content-between">
          <button class="btn btn-outline-light btn-sm" (click)="onAdjusterAssignClaim(claim.id)">
            <i class="fas fa-user-check me-1" *ngIf="claim.underwriter"></i>
            <i class="fas fa-user-plus me-1" *ngIf="!claim.underwriter"></i>
            {{ claim.underwriter ? 'Assigned' : 'Assign' }}
          </button>
          <button class="btn btn-light btn-sm" (click)="openClaimModal(claim)">
            <i class="fas fa-info-circle me-1"></i> Details
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- UNDERWRITER -->
  <div *ngIf="role === 'UNDERWRITER'" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div class="col" *ngFor="let claim of filteredUnderwriterClaims()">
      <div class="card gradient-card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">
            <i class="fas fa-file-contract me-2 text-primary"></i> Claim #{{ claim.id }}
          </h5>
          <p class="card-text text-truncate">
            <i class="fas fa-align-left me-2 text-secondary"></i> {{ claim.description }}
          </p>
          <p>
            <i class="fas fa-calendar-alt me-2 text-info"></i>
            <strong>Date:</strong> {{ claim.date | date:'dd-MM-yyyy' }}
          </p>
          <p>
            <i class="fas fa-flag me-2 text-warning"></i>
            <strong>Status:</strong>
            <span class="badge" [ngClass]="getStatusClass(claim.status)">{{ claim.status }}</span>
          </p>
        </div>
        <div class="card-footer text-center">
          <button class="btn btn-light btn-sm w-100" (click)="onUnderwriterUpdateClaim(claim.id)">
            <i class="fas fa-edit me-1"></i> Update
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- INVESTIGATOR -->
  <div *ngIf="role === 'INVESTIGATOR'" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div class="col" *ngFor="let investigation of filteredInvestigatorRecords()">
      <div class="card gradient-card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">
            <i class="fas fa-search-dollar me-2 text-success"></i> Investigation #{{ investigation.id }}
          </h5>
          <p class="card-text text-truncate">
            <i class="fas fa-fingerprint me-2 text-muted"></i> Investigation ID:{{ investigation.id }}
          </p>
          <p>
            <i class="fas fa-clipboard-list me-2 text-primary"></i>
            <strong>Claim:</strong> {{ investigation.claim.description }}
          </p>
          <p>
            <i class="fas fa-flag me-2 text-warning"></i>
            <strong>Status:</strong>
            <span class="badge" [ngClass]="getStatusClass(investigation.status)">{{ investigation.status }}</span>
          </p>
        </div>
        <div class="card-footer text-center">
          <button class="btn btn-light btn-sm w-100" (click)="onInvestigatorUpdateInvestigation(investigation.id)">
            <i class="fas fa-pencil-alt me-1"></i> Update
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- POLICYHOLDER -->
  <div *ngIf="role === 'POLICYHOLDER'" class="container">
    <!-- Connection status and debug info -->
    <div class="row mb-4" *ngIf="hasError">
      <div class="col">
        <div class="alert alert-danger">
          <h5><i class="fas fa-exclamation-triangle me-2"></i> Connection Error</h5>
          <p>There was an error connecting to the server. Please try the test connection button below.</p>
          <button class="btn btn-primary me-2" (click)="testConnection()" [disabled]="isLoading">
            <i class="fas fa-globe me-1"></i> {{ isLoading ? 'Testing...' : 'Test Connection' }}
          </button>
          <button class="btn btn-secondary" (click)="loadPolicyholderClaims()" [disabled]="isLoading">
            <i class="fas fa-sync-alt me-1"></i> {{ isLoading ? 'Loading...' : 'Retry Loading Claims' }}
          </button>
          <div *ngIf="errorDetails" class="mt-3">
            <pre class="bg-light p-3 rounded"><i class="fas fa-bug me-2"></i>{{ errorDetails }}</pre>
          </div>
        </div>
      </div>
    </div>

    <!-- Claims grid -->
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      <div class="col" *ngFor="let claim of filteredPolicyholderClaims()">
        <div class="card gradient-card h-100 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">
              <i class="fas fa-clipboard-list me-2 text-primary"></i> {{ claim.description }}
            </h5>
            <p class="card-text text-truncate">
              <i class="fas fa-id-badge me-2 text-muted"></i> Claim ID:{{ claim.id }}
            </p>
            <p>
              <i class="fas fa-calendar-alt me-2 text-info"></i>
              <strong>Date:</strong> {{ claim.date | date:'dd-MM-yyyy' }}
            </p>
            <p>
              <i class="fas fa-flag me-2 text-warning"></i>
              <strong>Status:</strong>
              <span class="badge" [ngClass]="getStatusClass(claim.status)">{{ claim.status }}</span>
            </p>
          </div>
          <div class="card-footer text-center">
            <button class="btn btn-light btn-sm w-100" (click)="openClaimModal(claim)">
              <i class="fas fa-eye me-1"></i> View Details
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading indicator -->
    <div *ngIf="isLoading" class="row mt-4">
      <div class="col text-center">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2"><i class="fas fa-spinner fa-spin me-1"></i> Loading your claims...</p>
      </div>
    </div>
  </div>

  <!-- ADMIN -->
  <!-- I'm keeping the ADMIN section commented out as it was in your original code, but I've added icons to it as well, just in case you uncomment it later. -->
  <div *ngIf="role === 'ADMIN'" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <div class="col" *ngFor="let policy of filteredPolicies()">
      <div class="card gradient-card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">
            <i class="fas fa-shield-alt me-2 text-success"></i> Policy #{{ policy.policyNumber }}
          </h5>
          <p class="card-text">
            <i class="fas fa-tag me-2 text-primary"></i>
            <strong>Type:</strong> {{ policy.policyType }}
          </p>
          <p>
            <i class="fas fa-doller-sign me-2 text-info"></i>
            <strong>Premium:</strong> â‚¹{{ policy.premium }}
          </p>
          <p>
            <i class="fas fa-clock me-2 text-secondary"></i>
            <strong>Term:</strong> {{ policy.termMonths }} months
          </p>
          <span class="badge bg-success"><i class="fas fa-check-circle me-1"></i> {{ policy.status }}</span>
        </div>
        <div class="card-footer text-center">
          <button class="btn btn-outline-light btn-sm" (click)="editPolicy(policy)">
            <i class="fas fa-edit me-1"></i> Edit
          </button>
          <button class="btn btn-danger btn-sm ms-2" (click)="deletePolicy(policy.id)">
            <i class="fas fa-trash-alt me-1"></i> Delete
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Claim Details Modal -->
  <div class="modal fade" id="claimModal" tabindex="-1" aria-labelledby="claimModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header modal-gradient text-white">
          <h5 class="modal-title" id="claimModalLabel">
            <i class="fas fa-file-invoice me-2"></i> Claim #{{ selectedClaim?.id }}
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p><i class="fas fa-info-circle me-2 text-primary"></i><strong>Description:</strong> {{ selectedClaim?.description }}</p>
          <p><i class="fas fa-calendar-alt me-2 text-info"></i><strong>Date:</strong> {{ selectedClaim?.date | date:'dd-MM-yyyy' }}</p>
          <p><i class="fas fa-flag me-2 text-warning"></i><strong>Status:</strong> {{ selectedClaim?.status}}</p>
          <p><i class="fas fa-user-tie me-2 text-success"></i><strong>Underwriter:</strong> {{ selectedClaim?.underwriter?.username || 'Not Assigned' }}</p>
          <p><i class="fas fa-user-secret me-2 text-danger"></i><strong>Investigator:</strong> {{ selectedClaim?.investigator?.username || 'Not Assigned' }}</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-1"></i> Close
          </button>
          <button *ngIf="role==='ADJUSTER'" class="btn btn-primary" (click)="onUpdateClaimAdjuster(selectedClaim.id)">
            <i class="fas fa-sync-alt me-1"></i> Update
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="snackbarToast" class="toast text-bg-success" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body"><i class="fas fa-check-circle me-2"></i>{{ snackbarMessage }}</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
          aria-label="Close"></button>
      </div>
    </div>
  </div>

</div>

<!-- IMPORTANT: Make sure you have included the Font Awesome library in your project.
     You can add it to your index.html <head> section like this (using a CDN for example):
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />
-->