<div class="container mt-4">
  <h4 class="mb-3">
    <i class="fas fa-shield-alt me-2 text-primary"></i> My Policies
  </h4>

  <div *ngIf="myPolicies.length === 0" class="alert alert-info alert-glass-effect fade-in">
    <i class="fas fa-info-circle me-2"></i> You have no policies yet.
  </div>

  <div class="table-responsive glass-table-container" *ngIf="myPolicies.length > 0">
    <table class="table table-hover table-striped glass-table">
      <thead>
        <tr>
          <th><i class="fas fa-hashtag me-2"></i>Policy ID</th>
          <th><i class="fas fa-signature me-2"></i>Name</th>
          <th><i class="fas fa-tag me-2"></i>Type</th>
          <th><i class="fas fa-money-bill-wave me-2"></i>Premium</th>
          <th><i class="fas fa-clock me-2"></i>Term (months)</th>
          <th><i class="fas fa-cogs me-2"></i>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of myPolicies">
          <td>{{ p.id }}</td>
          <td>{{ p.name }}</td>
          <td>{{ p.policyType }}</td>
          <td><i class="fas fa-rupee-sign me-1"></i>{{ p.premium }}</td>
          <td>{{ p.termMonths }}</td>
          <td>
            <button
              class="btn btn-sm me-2 claim-button"
              (click)="initiateClaim(p)" 
              [disabled]="p.status === 'Claimed'"
              [ngClass]="{'btn-success': p.status === 'Claimed', 'btn-primary': p.status !== 'Claimed'}"
            >
              <ng-container *ngIf="p.status === 'Claimed'">
                <i class="fas fa-check-circle me-1"></i> Claimed
              </ng-container>
              <ng-container *ngIf="p.status !== 'Claimed'">
                <i class="fas fa-exclamation-triangle me-1"></i> Claim
              </ng-container>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Claim Form Modal/Container -->
  <div class="claim-form-overlay" *ngIf="showClaimForm">
    <div class="claim-form-container">
      <h2>File a Claim for Policy "{{ selectedPolicy?.name }}"</h2>

      <form [formGroup]="claimForm" (ngSubmit)="submitClaim()">
        <div class="form-group">
          <label for="description">Description</label>
          <textarea id="description" formControlName="description" class="form-control" rows="4"
            placeholder="Enter claim description"></textarea>
          <div *ngIf="claimForm.get('description')?.touched && claimForm.get('description')?.invalid"
            class="error-message">
            Description required
          </div>
        </div>

        <div class="form-group">
          <label for="date">Date</label>
          <input type="date" id="date" formControlName="date" class="form-control" />
          <div *ngIf="claimForm.get('date')?.touched && claimForm.get('date')?.invalid" class="error-message">
            Please select a date
          </div>
        </div>

        <div class="form-group">
          <label for="status">Status</label>
          <select id="status" formControlName="status" class="form-control">
            <option value="Started">Started</option>
            <option value="In Progress">In Progress</option>
            <option value="Completed">Completed</option>
            <option value="Rejected">Rejected</option>
          </select>
          <div *ngIf="claimForm.get('status')?.touched && claimForm.get('status')?.invalid" class="error-message">
            Please select a status
          </div>
        </div>

        <button type="submit" [disabled]="!claimForm.valid" class="submit-button">
          Submit Claim
        </button>
        <button type="button" class="cancel-button" (click)="cancelClaim()">
          Cancel
        </button>
      </form>
    </div>
  </div>
</div>